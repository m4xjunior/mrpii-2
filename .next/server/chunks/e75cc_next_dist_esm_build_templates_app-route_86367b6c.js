module.exports=[85372,e=>{"use strict";e.s(["handler",()=>U,"patchFetch",()=>x,"routeModule",()=>E,"serverHooks",()=>w,"workAsyncStorage",()=>A,"workUnitAsyncStorage",()=>C],85372);var t=e.i(74353),a=e.i(19310),n=e.i(20050),i=e.i(32930),r=e.i(49260),s=e.i(25482),o=e.i(36688),l=e.i(23026),d=e.i(1251),c=e.i(6621),u=e.i(93265),p=e.i(72116),h=e.i(61195),m=e.i(99119),_=e.i(93695);e.i(4079);var R=e.i(55985);e.s(["GET",()=>v],45852);var g=e.i(12415);async function v(e){try{console.log("🧠 Generando insights simplificados");let e=await fetch("http://localhost:3000/api/scada/machines"),t=await e.json();if(!t.success||!t.data)return g.NextResponse.json({success:!1,error:"No se pudieron obtener datos de las máquinas"},{status:500});let a=t.data,n=a.map(e=>{let t=e.machine,a=(t.Rt_Unidades_ok||0)+(t.Rt_Unidades_nok||0)+(t.Rt_Unidades_rw||0),n=a>0?(t.Rt_Unidades_ok||0)/a*100:0,i=[];return"INACTIVA"===e.status&&i.push({tipo:"PARADA",severidad:"ALTA",mensaje:`M\xe1quina ${t.Cod_maquina} est\xe1 inactiva`,recomendacion:"Verificar y resolver la inactividad"}),n<80&&a>10&&i.push({tipo:"EFICIENCIA_BAJA",severidad:"MEDIA",mensaje:`Eficiencia baja en ${t.Cod_maquina}: ${n.toFixed(1)}%`,recomendacion:"Revisar parámetros de proceso"}),{machine_id:t.Cod_maquina,machine_name:t.desc_maquina,estado:e.status,eficiencia_calidad:n,progreso_of:t.Rt_Unidades_planning>0?a/t.Rt_Unidades_planning*100:0,alertas:i,metricas:{ok:t.Rt_Unidades_ok||0,nok:t.Rt_Unidades_nok||0,rw:t.Rt_Unidades_rw||0,total:a,velocidad_actual:e.velocity?.current||0,velocidad_nominal:e.velocity?.nominal||0}}}),i=a.filter(e=>"PRODUCIENDO"===e.status),r=a.filter(e=>"INACTIVA"===e.status),s=a.reduce((e,t)=>e+(t.machine?.Rt_Unidades_ok||0)+(t.machine?.Rt_Unidades_nok||0)+(t.machine?.Rt_Unidades_rw||0),0),o=a.reduce((e,t)=>e+(t.machine?.Rt_Unidades_ok||0),0),l={eficiencia_planta:{maquinas_activas:i.length,maquinas_inactivas:r.length,utilizacion:a.length>0?i.length/a.length*100:0,produccion_total:s,eficiencia_calidad_global:s>0?o/s*100:0},alertas_criticas:r.length,eficiencia_promedio:i.length>0?i.reduce((e,t)=>{let a=(t.machine?.Rt_Unidades_ok||0)+(t.machine?.Rt_Unidades_nok||0)+(t.machine?.Rt_Unidades_rw||0);return e+(a>0?(t.machine?.Rt_Unidades_ok||0)/a*100:0)},0)/i.length:0};return g.NextResponse.json({success:!0,data:{timestamp:new Date().toISOString(),turno:"ACTUAL",insights_maquinas:n,insights_planta:l,acciones_recomendadas:r.length>0?[{prioridad:"CRITICA",categoria:"INACTIVIDAD",descripcion:`${r.length} m\xe1quinas inactivas`,accion:"Resolver inactividad de máquinas",impacto:"Alto - afecta producción total"}]:[],resumen:{total_maquinas:a.length,maquinas_activas:i.length,maquinas_inactivas:r.length,total_alertas:n.reduce((e,t)=>e+t.alertas.length,0),eficiencia_promedio_planta:l.eficiencia_promedio}}})}catch(e){return console.error("❌ Error generando insights:",e),g.NextResponse.json({success:!1,error:"Error al generar insights",message:e instanceof Error?e.message:"Error desconocido"},{status:500})}}e.i(50619),e.i(43492),e.i(37591);var f=e.i(45852);let E=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/analytics/insights/route",pathname:"/api/analytics/insights",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/Downloads/mrpii 2/src/app/api/analytics/insights/route.ts",nextConfigOutput:"",userland:f}),{workAsyncStorage:A,workUnitAsyncStorage:C,serverHooks:w}=E;function x(){return(0,n.patchFetch)({workAsyncStorage:A,workUnitAsyncStorage:C})}async function U(e,t,n){var g;let v="/api/analytics/insights/route";v=v.replace(/\/index$/,"")||"/";let f=await E.prepare(e,t,{srcPage:v,multiZoneDraftMode:!1});if(!f)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:A,params:C,nextConfig:w,isDraftMode:x,prerenderManifest:U,routerServerContext:y,isOnDemandRevalidate:N,revalidateOnlyGenerated:I,resolvedPathname:T}=f,q=(0,s.normalizeAppPath)(v),k=!!(U.dynamicRoutes[q]||U.routes[T]);if(k&&!x){let e=!!U.routes[T],t=U.dynamicRoutes[q];if(t&&!1===t.fallback&&!e)throw new _.NoFallbackError}let O=null;!k||E.isDev||x||(O="/index"===(O=T)?"/":O);let P=!0===E.isDev||!k,b=k&&!P,D=e.method||"GET",S=(0,r.getTracer)(),H=S.getActiveScopeSpan(),M={params:C,prerenderManifest:U,renderOpts:{experimental:{cacheComponents:!!w.experimental.cacheComponents,authInterrupts:!!w.experimental.authInterrupts},supportsDynamicResponse:P,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:null==(g=w.experimental)?void 0:g.cacheLife,isRevalidate:b,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,n)=>E.onRequestError(e,t,n,y)},sharedContext:{buildId:A}},j=new o.NodeNextRequest(e),$=new o.NodeNextResponse(t),F=l.NextRequestAdapter.fromNodeNextRequest(j,(0,l.signalFromNodeResponse)(t));try{let s=async a=>E.handle(F,M).finally(()=>{if(!a)return;a.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let n=S.getRootSpanAttributes();if(!n)return;if(n.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${n.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=n.get("next.route");if(i){let e=`${D} ${i}`;a.setAttributes({"next.route":i,"http.route":i,"next.span_name":e}),a.updateName(e)}else a.updateName(`${D} ${e.url}`)}),o=async r=>{var o,l;let d=async({previousCacheEntry:a})=>{try{if(!(0,i.getRequestMeta)(e,"minimalMode")&&N&&I&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await s(r);e.fetchMetrics=M.renderOpts.fetchMetrics;let l=M.renderOpts.pendingWaitUntil;l&&n.waitUntil&&(n.waitUntil(l),l=void 0);let d=M.renderOpts.collectedTags;if(!k)return await (0,u.sendResponse)(j,$,o,M.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,p.toNodeOutgoingHttpHeaders)(o.headers);d&&(t[m.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==M.renderOpts.collectedRevalidate&&!(M.renderOpts.collectedRevalidate>=m.INFINITE_CACHE)&&M.renderOpts.collectedRevalidate,n=void 0===M.renderOpts.collectedExpire||M.renderOpts.collectedExpire>=m.INFINITE_CACHE?void 0:M.renderOpts.collectedExpire;return{value:{kind:R.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:n}}}}catch(t){throw(null==a?void 0:a.isStale)&&await E.onRequestError(e,t,{routerKind:"App Router",routePath:v,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isRevalidate:b,isOnDemandRevalidate:N})},y),t}},_=await E.handleResponse({req:e,nextConfig:w,cacheKey:O,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:U,isRoutePPREnabled:!1,isOnDemandRevalidate:N,revalidateOnlyGenerated:I,responseGenerator:d,waitUntil:n.waitUntil});if(!k)return null;if((null==_||null==(o=_.value)?void 0:o.kind)!==R.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==_||null==(l=_.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,i.getRequestMeta)(e,"minimalMode")||t.setHeader("x-nextjs-cache",N?"REVALIDATED":_.isMiss?"MISS":_.isStale?"STALE":"HIT"),x&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let g=(0,p.fromNodeOutgoingHttpHeaders)(_.value.headers);return(0,i.getRequestMeta)(e,"minimalMode")&&k||g.delete(m.NEXT_CACHE_TAGS_HEADER),!_.cacheControl||t.getHeader("Cache-Control")||g.get("Cache-Control")||g.set("Cache-Control",(0,h.getCacheControlHeader)(_.cacheControl)),await (0,u.sendResponse)(j,$,new Response(_.value.body,{headers:g,status:_.value.status||200})),null};H?await o(H):await S.withPropagatedContext(e.headers,()=>S.trace(d.BaseServerSpan.handleRequest,{spanName:`${D} ${e.url}`,kind:r.SpanKind.SERVER,attributes:{"http.method":D,"http.target":e.url}},o))}catch(t){if(H||t instanceof _.NoFallbackError||await E.onRequestError(e,t,{routerKind:"App Router",routePath:q,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isRevalidate:b,isOnDemandRevalidate:N})}),k)throw t;return await (0,u.sendResponse)(j,$,new Response(null,{status:500})),null}}}];

//# sourceMappingURL=e75cc_next_dist_esm_build_templates_app-route_86367b6c.js.map