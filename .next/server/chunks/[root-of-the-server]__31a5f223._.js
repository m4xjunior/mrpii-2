module.exports = [
"[project]/Downloads/mrpii 2/.next-internal/server/app/api/analytics/monthly/route/actions.js [app-rsc] (server actions loader, ecmascript)", ((__turbopack_context__, module, exports) => {

}),
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/shared/lib/no-fallback-error.external.js [external] (next/dist/shared/lib/no-fallback-error.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/shared/lib/no-fallback-error.external.js", () => require("next/dist/shared/lib/no-fallback-error.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/action-async-storage.external.js [external] (next/dist/server/app-render/action-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/action-async-storage.external.js", () => require("next/dist/server/app-render/action-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/events [external] (events, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("events", () => require("events"));

module.exports = mod;
}),
"[externals]/stream [external] (stream, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("stream", () => require("stream"));

module.exports = mod;
}),
"[externals]/crypto [external] (crypto, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("crypto", () => require("crypto"));

module.exports = mod;
}),
"[externals]/os [external] (os, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("os", () => require("os"));

module.exports = mod;
}),
"[externals]/tls [external] (tls, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("tls", () => require("tls"));

module.exports = mod;
}),
"[externals]/net [external] (net, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("net", () => require("net"));

module.exports = mod;
}),
"[externals]/dns [external] (dns, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("dns", () => require("dns"));

module.exports = mod;
}),
"[externals]/constants [external] (constants, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("constants", () => require("constants"));

module.exports = mod;
}),
"[externals]/node:os [external] (node:os, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:os", () => require("node:os"));

module.exports = mod;
}),
"[externals]/node:util [external] (node:util, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:util", () => require("node:util"));

module.exports = mod;
}),
"[externals]/node:process [external] (node:process, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:process", () => require("node:process"));

module.exports = mod;
}),
"[externals]/node:crypto [external] (node:crypto, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:crypto", () => require("node:crypto"));

module.exports = mod;
}),
"[externals]/node:http [external] (node:http, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:http", () => require("node:http"));

module.exports = mod;
}),
"[externals]/node:https [external] (node:https, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:https", () => require("node:https"));

module.exports = mod;
}),
"[externals]/node:zlib [external] (node:zlib, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:zlib", () => require("node:zlib"));

module.exports = mod;
}),
"[externals]/node:stream [external] (node:stream, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:stream", () => require("node:stream"));

module.exports = mod;
}),
"[externals]/assert [external] (assert, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("assert", () => require("assert"));

module.exports = mod;
}),
"[externals]/tty [external] (tty, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("tty", () => require("tty"));

module.exports = mod;
}),
"[externals]/util [external] (util, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("util", () => require("util"));

module.exports = mod;
}),
"[externals]/http [external] (http, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("http", () => require("http"));

module.exports = mod;
}),
"[externals]/https [external] (https, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("https", () => require("https"));

module.exports = mod;
}),
"[externals]/url [external] (url, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("url", () => require("url"));

module.exports = mod;
}),
"[externals]/buffer [external] (buffer, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("buffer", () => require("buffer"));

module.exports = mod;
}),
"[externals]/fs [external] (fs, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("fs", () => require("fs"));

module.exports = mod;
}),
"[externals]/path [external] (path, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("path", () => require("path"));

module.exports = mod;
}),
"[externals]/node:fs/promises [external] (node:fs/promises, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:fs/promises", () => require("node:fs/promises"));

module.exports = mod;
}),
"[externals]/child_process [external] (child_process, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("child_process", () => require("child_process"));

module.exports = mod;
}),
"[externals]/node:child_process [external] (node:child_process, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:child_process", () => require("node:child_process"));

module.exports = mod;
}),
"[externals]/dgram [external] (dgram, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("dgram", () => require("dgram"));

module.exports = mod;
}),
"[externals]/node:url [external] (node:url, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:url", () => require("node:url"));

module.exports = mod;
}),
"[externals]/string_decoder [external] (string_decoder, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("string_decoder", () => require("string_decoder"));

module.exports = mod;
}),
"[project]/Downloads/mrpii 2/lib/database/connection.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "closeDbConnection",
    ()=>closeDbConnection,
    "executeQuery",
    ()=>executeQuery,
    "getDbConnection",
    ()=>getDbConnection,
    "testConnections",
    ()=>testConnections
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$node_modules$2f$tedious$2f$lib$2f$tedious$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/Downloads/mrpii 2/node_modules/tedious/lib/tedious.js [app-route] (ecmascript)");
;
// Configuraciones para m√∫ltiples bases de datos como en el PHP original
const baseConfig = {
    server: process.env.DB_SERVER || '10.0.0.45',
    authentication: {
        type: 'default',
        options: {
            userName: process.env.DB_USER || 'sa',
            password: process.env.DB_PASSWORD || 'Mapexdd2017'
        }
    },
    options: {
        port: parseInt(process.env.DB_PORT || '1433'),
        encrypt: false,
        trustServerCertificate: true,
        connectTimeout: 30000,
        requestTimeout: 30000,
        enableArithAbort: true
    }
};
// Configuraciones espec√≠ficas para cada base de datos
const mapexConfig = {
    ...baseConfig,
    options: {
        ...baseConfig.options,
        database: process.env.DB_NAME || 'mapexbp_Test'
    }
};
const sageConfig = {
    ...baseConfig,
    authentication: {
        type: 'default',
        options: {
            userName: 'sa',
            password: 'admin000'
        }
    },
    options: {
        ...baseConfig.options,
        database: 'SAGE'
    }
};
const whalesConfig = {
    ...baseConfig,
    authentication: {
        type: 'default',
        options: {
            userName: 'sa',
            password: '87cc88bb89.'
        }
    },
    options: {
        ...baseConfig.options,
        database: 'WHALES'
    }
};
async function getDbConnection(database = 'mapex') {
    let config;
    switch(database){
        case 'mapex':
            config = mapexConfig;
            break;
        case 'sage':
            config = sageConfig;
            break;
        case 'whales':
            config = whalesConfig;
            break;
        default:
            config = mapexConfig;
    }
    const connection = new __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$node_modules$2f$tedious$2f$lib$2f$tedious$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["Connection"](config);
    return new Promise((resolve, reject)=>{
        connection.on('connect', (err)=>{
            if (err) {
                console.error(`‚ùå Erro ao conectar √† base ${database.toUpperCase()}:`, err);
                reject(err);
            } else {
                console.log(`‚úÖ Nova conex√£o criada para ${database.toUpperCase()}`);
                resolve(connection);
            }
        });
        connection.on('error', (err)=>{
            console.error(`‚ùå Erro na conex√£o ${database.toUpperCase()}:`, err);
            reject(err);
        });
        // N√£o definir on('end') aqui pois vamos fechar manualmente
        connection.connect();
    });
}
async function executeQuery(sql, parameters, database = 'mapex') {
    const conn = await getDbConnection(database);
    return new Promise((resolve, reject)=>{
        const results = [];
        const request = new __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$node_modules$2f$tedious$2f$lib$2f$tedious$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["Request"](sql, (err)=>{
            // Sempre fechar a conex√£o ap√≥s completar a query
            try {
                conn.close();
            } catch (closeErr) {
                console.warn('‚ö†Ô∏è Erro ao fechar conex√£o:', closeErr);
            }
            if (err) {
                console.error(`‚ùå Erro na query ${database.toUpperCase()}:`, err);
                console.error('SQL:', sql.substring(0, 200) + '...');
                reject(err);
            } else {
                resolve(results);
            }
        });
        // Adicionar par√¢metros se fornecidos
        if (parameters) {
            Object.entries(parameters).forEach(([key, value])=>{
                let type = __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$node_modules$2f$tedious$2f$lib$2f$tedious$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["TYPES"].NVarChar;
                if (typeof value === 'number') {
                    type = Number.isInteger(value) ? __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$node_modules$2f$tedious$2f$lib$2f$tedious$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["TYPES"].Int : __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$node_modules$2f$tedious$2f$lib$2f$tedious$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["TYPES"].Float;
                } else if (typeof value === 'boolean') {
                    type = __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$node_modules$2f$tedious$2f$lib$2f$tedious$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["TYPES"].Bit;
                } else if (value instanceof Date) {
                    type = __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$node_modules$2f$tedious$2f$lib$2f$tedious$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["TYPES"].DateTime;
                }
                request.addParameter(key, type, value);
            });
        }
        request.on('row', (columns)=>{
            const row = {};
            columns.forEach((column)=>{
                row[column.metadata.colName] = column.value;
            });
            results.push(row);
        });
        try {
            conn.execSql(request);
        } catch (execErr) {
            // Se houver erro na execu√ß√£o, fechar conex√£o e rejeitar
            try {
                conn.close();
            } catch (closeErr) {
                console.warn('‚ö†Ô∏è Erro ao fechar conex√£o ap√≥s falha:', closeErr);
            }
            reject(execErr);
        }
    });
}
async function closeDbConnection(database) {
    // Como agora criamos uma nova conex√£o para cada query e fechamos automaticamente,
    // esta fun√ß√£o √© mantida por compatibilidade mas n√£o faz mais sentido
    console.log('‚ÑπÔ∏è Conex√µes agora s√£o gerenciadas automaticamente por query');
}
async function testConnections() {
    const results = {};
    for (const db of [
        'mapex',
        'sage',
        'whales'
    ]){
        try {
            await executeQuery('SELECT 1 as test', undefined, db);
            results[db] = true;
            console.log(`‚úÖ Teste de conectividade ${db.toUpperCase()}: OK`);
        } catch (error) {
            results[db] = false;
            console.error(`‚ùå Teste de conectividade ${db.toUpperCase()}: FALHOU`, error);
        }
    }
    return results;
}
}),
"[project]/Downloads/mrpii 2/src/app/api/scada/costs-config/route.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "GET",
    ()=>GET,
    "POST",
    ()=>POST,
    "getAllProductCosts",
    ()=>getAllProductCosts,
    "getProductCost",
    ()=>getProductCost
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/Downloads/mrpii 2/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$lib$2f$database$2f$connection$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/Downloads/mrpii 2/lib/database/connection.ts [app-route] (ecmascript)");
;
;
async function getProductCost(cod_producto) {
    try {
        // Consulta simple para obtener costo configurado
        const sql = `
      SELECT TOP 1
        cp.cod_producto,
        0 as costo_default -- Por defecto
      FROM cfg_producto cp
      WHERE cp.cod_producto = @cod_producto
        AND cp.activo = 1
    `;
        const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$lib$2f$database$2f$connection$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["executeQuery"])(sql, {
            cod_producto
        });
        if (!result || result.length === 0) {
            console.warn(`‚ö†Ô∏è Producto ${cod_producto} no encontrado, usando costo por defecto ‚Ç¨0`);
            return 0;
        }
        // Por ahora, retornar costo por defecto
        // TODO: Implementar tabla de configuraci√≥n real
        return 0;
    } catch (error) {
        console.error(`‚ùå Error obteniendo costo para ${cod_producto}:`, error);
        return 0; // Fallback a valor por defecto
    }
}
async function getAllProductCosts() {
    try {
        console.log('üí∞ Obteniendo todos los costos de productos');
        // Consulta para obtener todos los productos activos
        const sql = `
      SELECT DISTINCT
        cp.cod_producto,
        0 as costo_default -- Por defecto
      FROM cfg_producto cp
      WHERE cp.activo = 1
        AND cp.cod_producto IS NOT NULL
        AND cp.cod_producto != ''
        AND cp.cod_producto != '--'
        AND cp.cod_producto != '{0}'
    `;
        const products = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$lib$2f$database$2f$connection$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["executeQuery"])(sql);
        const costMap = {};
        if (products && products.length > 0) {
            products.forEach((product)=>{
                costMap[product.cod_producto] = product.costo_default;
            });
        }
        console.log(`üí∞ Costos obtenidos para ${Object.keys(costMap).length} productos`);
        return costMap;
    } catch (error) {
        console.error('‚ùå Error obteniendo todos los costos:', error);
        return {}; // Retornar mapa vac√≠o como fallback
    }
}
async function GET(request) {
    try {
        console.log('‚öôÔ∏è Obteniendo configuraci√≥n de costos');
        // Obtener productos con sus m√°quinas asociadas
        const sql = `
      SELECT DISTINCT
        cp.cod_producto,
        cp.desc_producto,
        cm.Cod_maquina,
        cm.desc_maquina,
        0 as costo_unitario_default -- Sin productos = costo cero
      FROM cfg_producto cp
      LEFT JOIN cfg_maquina cm ON cp.cod_producto = cm.rt_Cod_producto
      WHERE cp.activo = 1
        AND cp.cod_producto IS NOT NULL
        AND cp.cod_producto != ''
        AND cp.cod_producto != '--'
        AND cp.cod_producto != '{0}'
      ORDER BY cp.cod_producto, cm.Cod_maquina
    `;
        const products = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$lib$2f$database$2f$connection$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["executeQuery"])(sql);
        // Crear estructura de respuesta
        const costConfig = {};
        products.forEach((product)=>{
            const productKey = product.cod_producto;
            if (!costConfig[productKey]) {
                costConfig[productKey] = {
                    cod_producto: product.cod_producto,
                    desc_producto: product.desc_producto,
                    costo_unitario: product.costo_unitario_default,
                    maquinas: [],
                    nota: 'Costo configurado manualmente (no viene de MAPEX)'
                };
            }
            if (product.Cod_maquina) {
                costConfig[productKey].maquinas.push({
                    cod_maquina: product.Cod_maquina,
                    desc_maquina: product.desc_maquina
                });
            }
        });
        console.log('‚öôÔ∏è Configuraci√≥n de costos obtenida:', Object.keys(costConfig).length, 'productos');
        return __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: true,
            data: costConfig,
            timestamp: new Date().toISOString(),
            nota: 'Costos por defecto: ‚Ç¨0. Configure valores reales usando POST'
        });
    } catch (error) {
        console.error('‚ùå Error obteniendo configuraci√≥n de costos:', error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: false,
            error: 'Error al obtener configuraci√≥n de costos',
            details: error instanceof Error ? error.message : 'Error desconocido',
            timestamp: new Date().toISOString()
        }, {
            status: 500
        });
    }
}
async function POST(request) {
    try {
        console.log('üíæ Configurando costo personalizado');
        const body = await request.json();
        const { cod_producto, costo_unitario, maquina_id } = body;
        if (!cod_producto || costo_unitario === undefined) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                success: false,
                error: 'Faltan par√°metros requeridos: cod_producto y costo_unitario',
                timestamp: new Date().toISOString()
            }, {
                status: 400
            });
        }
        // Validar que el producto existe en MAPEX
        const checkProductSql = `
      SELECT cod_producto, desc_producto
      FROM cfg_producto
      WHERE cod_producto = @cod_producto
        AND activo = 1
    `;
        const productExists = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$lib$2f$database$2f$connection$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["executeQuery"])(checkProductSql, {
            cod_producto
        });
        if (!productExists || productExists.length === 0) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                success: false,
                error: `Producto ${cod_producto} no encontrado en MAPEX`,
                timestamp: new Date().toISOString()
            }, {
                status: 404
            });
        }
        // Aqu√≠ se podr√≠a guardar en una tabla de configuraci√≥n
        // Por ahora, simularemos el guardado
        console.log('üíæ Costo configurado:', {
            cod_producto,
            costo_unitario,
            maquina_id,
            producto: productExists[0].desc_producto
        });
        return __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: true,
            message: `Costo de ‚Ç¨${costo_unitario} configurado para producto ${cod_producto}`,
            data: {
                cod_producto,
                costo_unitario: parseFloat(costo_unitario),
                maquina_id,
                producto_descripcion: productExists[0].desc_producto
            },
            timestamp: new Date().toISOString()
        });
    } catch (error) {
        console.error('‚ùå Error configurando costo:', error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: false,
            error: 'Error al configurar costo',
            details: error instanceof Error ? error.message : 'Error desconocido',
            timestamp: new Date().toISOString()
        }, {
            status: 500
        });
    }
}
}),
"[project]/Downloads/mrpii 2/src/app/api/analytics/monthly/route.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "GET",
    ()=>GET
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/Downloads/mrpii 2/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$src$2f$app$2f$api$2f$scada$2f$costs$2d$config$2f$route$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/Downloads/mrpii 2/src/app/api/scada/costs-config/route.ts [app-route] (ecmascript)");
;
;
async function GET(request) {
    try {
        console.log('üìä Obteniendo resumen mensual');
        // Usar datos de producci√≥n actuales para calcular resumen mensual aproximado
        const productionResponse = await fetch('http://localhost:3000/api/scada/production');
        const productionResult = await productionResponse.json();
        if (!productionResult.success || !productionResult.data) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                success: false,
                message: 'No se pudieron obtener datos de producci√≥n'
            }, {
                status: 500
            });
        }
        const machines = productionResult.data;
        const now = new Date();
        const daysInMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
        // Calcular totales mensuales aproximados
        const totalOk = machines.reduce((sum, machine)=>sum + (machine.ok || 0), 0);
        const totalNok = machines.reduce((sum, machine)=>sum + (machine.nok || 0), 0);
        const totalRw = machines.reduce((sum, machine)=>sum + (machine.rw || 0), 0);
        const totalProduction = totalOk + totalNok + totalRw;
        // Estimar valores mensuales basados en datos actuales
        const estimatedMonthlyOk = Math.floor(totalOk * daysInMonth * 0.8); // 80% del d√≠a actual
        const estimatedMonthlyNok = Math.floor(totalNok * daysInMonth * 0.8);
        const estimatedMonthlyRw = Math.floor(totalRw * daysInMonth * 0.8);
        const estimatedMonthlyTotal = estimatedMonthlyOk + estimatedMonthlyNok + estimatedMonthlyRw;
        // Obtener costos de productos desde MAPEX
        const productCosts = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$src$2f$app$2f$api$2f$scada$2f$costs$2d$config$2f$route$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getAllProductCosts"])();
        // Calcular costo promedio por pieza NOK
        const costoPromedioNok = Object.keys(productCosts).length > 0 ? Object.values(productCosts).reduce((sum, cost)=>sum + cost, 0) / Object.keys(productCosts).length : 0; // Sin productos = costo cero
        console.log('üí∞ Costo promedio calculado:', {
            totalProductos: Object.keys(productCosts).length,
            costoPromedio: costoPromedioNok,
            nota: Object.keys(productCosts).length > 0 ? 'Basado en costos reales de MAPEX' : 'Sin productos activos - costo cero'
        });
        const data = {
            ok: estimatedMonthlyOk,
            nok: estimatedMonthlyNok,
            rw: estimatedMonthlyRw,
            total: estimatedMonthlyTotal,
            eficiencia: totalProduction > 0 ? totalOk / totalProduction * 100 : 0,
            perdidas_eur: estimatedMonthlyNok * costoPromedioNok
        };
        console.log('üìä Resumen mensual estimado:', {
            ...data,
            calculo_perdidas: costoPromedioNok > 0 ? `${estimatedMonthlyNok} NOK √ó ‚Ç¨${costoPromedioNok.toFixed(2)} = ‚Ç¨${(estimatedMonthlyNok * costoPromedioNok).toFixed(2)}` : `${estimatedMonthlyNok} NOK √ó ‚Ç¨0.00 = ‚Ç¨0.00 (sin productos activos)`,
            nota: costoPromedioNok > 0 ? 'Costo basado en configuraci√≥n de productos MAPEX' : 'Sin productos activos - p√©rdidas en cero',
            costo_promedio_usado: costoPromedioNok
        });
        return __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: true,
            data,
            timestamp: new Date().toISOString(),
            note: 'Datos estimados basados en producci√≥n actual (MAPEX no disponible)'
        });
    } catch (error) {
        console.error('‚ùå Error en resumen mensual:', error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: false,
            message: 'Error al obtener resumen mensual'
        }, {
            status: 500
        });
    }
}
}),
];

//# sourceMappingURL=%5Broot-of-the-server%5D__31a5f223._.js.map