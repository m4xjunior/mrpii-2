module.exports = [
"[project]/Downloads/mrpii 2/.next-internal/server/app/api/analytics/daily/route/actions.js [app-rsc] (server actions loader, ecmascript)", ((__turbopack_context__, module, exports) => {

}),
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/shared/lib/no-fallback-error.external.js [external] (next/dist/shared/lib/no-fallback-error.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/shared/lib/no-fallback-error.external.js", () => require("next/dist/shared/lib/no-fallback-error.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/action-async-storage.external.js [external] (next/dist/server/app-render/action-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/action-async-storage.external.js", () => require("next/dist/server/app-render/action-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/events [external] (events, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("events", () => require("events"));

module.exports = mod;
}),
"[externals]/stream [external] (stream, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("stream", () => require("stream"));

module.exports = mod;
}),
"[externals]/crypto [external] (crypto, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("crypto", () => require("crypto"));

module.exports = mod;
}),
"[externals]/os [external] (os, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("os", () => require("os"));

module.exports = mod;
}),
"[externals]/tls [external] (tls, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("tls", () => require("tls"));

module.exports = mod;
}),
"[externals]/net [external] (net, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("net", () => require("net"));

module.exports = mod;
}),
"[externals]/dns [external] (dns, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("dns", () => require("dns"));

module.exports = mod;
}),
"[externals]/constants [external] (constants, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("constants", () => require("constants"));

module.exports = mod;
}),
"[externals]/node:os [external] (node:os, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:os", () => require("node:os"));

module.exports = mod;
}),
"[externals]/node:util [external] (node:util, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:util", () => require("node:util"));

module.exports = mod;
}),
"[externals]/node:process [external] (node:process, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:process", () => require("node:process"));

module.exports = mod;
}),
"[externals]/node:crypto [external] (node:crypto, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:crypto", () => require("node:crypto"));

module.exports = mod;
}),
"[externals]/node:http [external] (node:http, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:http", () => require("node:http"));

module.exports = mod;
}),
"[externals]/node:https [external] (node:https, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:https", () => require("node:https"));

module.exports = mod;
}),
"[externals]/node:zlib [external] (node:zlib, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:zlib", () => require("node:zlib"));

module.exports = mod;
}),
"[externals]/node:stream [external] (node:stream, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:stream", () => require("node:stream"));

module.exports = mod;
}),
"[externals]/assert [external] (assert, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("assert", () => require("assert"));

module.exports = mod;
}),
"[externals]/tty [external] (tty, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("tty", () => require("tty"));

module.exports = mod;
}),
"[externals]/util [external] (util, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("util", () => require("util"));

module.exports = mod;
}),
"[externals]/http [external] (http, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("http", () => require("http"));

module.exports = mod;
}),
"[externals]/https [external] (https, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("https", () => require("https"));

module.exports = mod;
}),
"[externals]/url [external] (url, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("url", () => require("url"));

module.exports = mod;
}),
"[externals]/buffer [external] (buffer, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("buffer", () => require("buffer"));

module.exports = mod;
}),
"[externals]/fs [external] (fs, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("fs", () => require("fs"));

module.exports = mod;
}),
"[externals]/path [external] (path, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("path", () => require("path"));

module.exports = mod;
}),
"[externals]/node:fs/promises [external] (node:fs/promises, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:fs/promises", () => require("node:fs/promises"));

module.exports = mod;
}),
"[externals]/child_process [external] (child_process, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("child_process", () => require("child_process"));

module.exports = mod;
}),
"[externals]/node:child_process [external] (node:child_process, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:child_process", () => require("node:child_process"));

module.exports = mod;
}),
"[externals]/dgram [external] (dgram, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("dgram", () => require("dgram"));

module.exports = mod;
}),
"[externals]/node:url [external] (node:url, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:url", () => require("node:url"));

module.exports = mod;
}),
"[externals]/string_decoder [external] (string_decoder, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("string_decoder", () => require("string_decoder"));

module.exports = mod;
}),
"[project]/Downloads/mrpii 2/lib/database/connection.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "closeDbConnection",
    ()=>closeDbConnection,
    "executeQuery",
    ()=>executeQuery,
    "getDbConnection",
    ()=>getDbConnection,
    "testConnections",
    ()=>testConnections
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$node_modules$2f$tedious$2f$lib$2f$tedious$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/Downloads/mrpii 2/node_modules/tedious/lib/tedious.js [app-route] (ecmascript)");
;
// Configuraciones para múltiples bases de datos como en el PHP original
const baseConfig = {
    server: process.env.DB_SERVER || '10.0.0.45',
    authentication: {
        type: 'default',
        options: {
            userName: process.env.DB_USER || 'sa',
            password: process.env.DB_PASSWORD || 'Mapexdd2017'
        }
    },
    options: {
        port: parseInt(process.env.DB_PORT || '1433'),
        encrypt: false,
        trustServerCertificate: true,
        connectTimeout: 30000,
        requestTimeout: 30000,
        enableArithAbort: true
    }
};
// Configuraciones específicas para cada base de datos
const mapexConfig = {
    ...baseConfig,
    options: {
        ...baseConfig.options,
        database: process.env.DB_NAME || 'mapexbp_Test'
    }
};
const sageConfig = {
    ...baseConfig,
    authentication: {
        type: 'default',
        options: {
            userName: 'sa',
            password: 'admin000'
        }
    },
    options: {
        ...baseConfig.options,
        database: 'SAGE'
    }
};
const whalesConfig = {
    ...baseConfig,
    authentication: {
        type: 'default',
        options: {
            userName: 'sa',
            password: '87cc88bb89.'
        }
    },
    options: {
        ...baseConfig.options,
        database: 'WHALES'
    }
};
async function getDbConnection(database = 'mapex') {
    let config;
    switch(database){
        case 'mapex':
            config = mapexConfig;
            break;
        case 'sage':
            config = sageConfig;
            break;
        case 'whales':
            config = whalesConfig;
            break;
        default:
            config = mapexConfig;
    }
    const connection = new __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$node_modules$2f$tedious$2f$lib$2f$tedious$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["Connection"](config);
    return new Promise((resolve, reject)=>{
        connection.on('connect', (err)=>{
            if (err) {
                console.error(`❌ Erro ao conectar à base ${database.toUpperCase()}:`, err);
                reject(err);
            } else {
                console.log(`✅ Nova conexão criada para ${database.toUpperCase()}`);
                resolve(connection);
            }
        });
        connection.on('error', (err)=>{
            console.error(`❌ Erro na conexão ${database.toUpperCase()}:`, err);
            reject(err);
        });
        // Não definir on('end') aqui pois vamos fechar manualmente
        connection.connect();
    });
}
async function executeQuery(sql, parameters, database = 'mapex') {
    const conn = await getDbConnection(database);
    return new Promise((resolve, reject)=>{
        const results = [];
        const request = new __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$node_modules$2f$tedious$2f$lib$2f$tedious$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["Request"](sql, (err)=>{
            // Sempre fechar a conexão após completar a query
            try {
                conn.close();
            } catch (closeErr) {
                console.warn('⚠️ Erro ao fechar conexão:', closeErr);
            }
            if (err) {
                console.error(`❌ Erro na query ${database.toUpperCase()}:`, err);
                console.error('SQL:', sql.substring(0, 200) + '...');
                reject(err);
            } else {
                resolve(results);
            }
        });
        // Adicionar parâmetros se fornecidos
        if (parameters) {
            Object.entries(parameters).forEach(([key, value])=>{
                let type = __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$node_modules$2f$tedious$2f$lib$2f$tedious$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["TYPES"].NVarChar;
                if (typeof value === 'number') {
                    type = Number.isInteger(value) ? __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$node_modules$2f$tedious$2f$lib$2f$tedious$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["TYPES"].Int : __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$node_modules$2f$tedious$2f$lib$2f$tedious$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["TYPES"].Float;
                } else if (typeof value === 'boolean') {
                    type = __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$node_modules$2f$tedious$2f$lib$2f$tedious$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["TYPES"].Bit;
                } else if (value instanceof Date) {
                    type = __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$node_modules$2f$tedious$2f$lib$2f$tedious$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["TYPES"].DateTime;
                }
                request.addParameter(key, type, value);
            });
        }
        request.on('row', (columns)=>{
            const row = {};
            columns.forEach((column)=>{
                row[column.metadata.colName] = column.value;
            });
            results.push(row);
        });
        try {
            conn.execSql(request);
        } catch (execErr) {
            // Se houver erro na execução, fechar conexão e rejeitar
            try {
                conn.close();
            } catch (closeErr) {
                console.warn('⚠️ Erro ao fechar conexão após falha:', closeErr);
            }
            reject(execErr);
        }
    });
}
async function closeDbConnection(database) {
    // Como agora criamos uma nova conexão para cada query e fechamos automaticamente,
    // esta função é mantida por compatibilidade mas não faz mais sentido
    console.log('ℹ️ Conexões agora são gerenciadas automaticamente por query');
}
async function testConnections() {
    const results = {};
    for (const db of [
        'mapex',
        'sage',
        'whales'
    ]){
        try {
            await executeQuery('SELECT 1 as test', undefined, db);
            results[db] = true;
            console.log(`✅ Teste de conectividade ${db.toUpperCase()}: OK`);
        } catch (error) {
            results[db] = false;
            console.error(`❌ Teste de conectividade ${db.toUpperCase()}: FALHOU`, error);
        }
    }
    return results;
}
}),
"[project]/Downloads/mrpii 2/src/app/api/scada/costs-config/route.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "GET",
    ()=>GET,
    "POST",
    ()=>POST,
    "getAllProductCosts",
    ()=>getAllProductCosts,
    "getProductCost",
    ()=>getProductCost
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/Downloads/mrpii 2/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$lib$2f$database$2f$connection$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/Downloads/mrpii 2/lib/database/connection.ts [app-route] (ecmascript)");
;
;
async function getProductCost(cod_producto) {
    try {
        // Consulta simple para obtener costo configurado
        const sql = `
      SELECT TOP 1
        cp.cod_producto,
        0 as costo_default -- Por defecto
      FROM cfg_producto cp
      WHERE cp.cod_producto = @cod_producto
        AND cp.activo = 1
    `;
        const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$lib$2f$database$2f$connection$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["executeQuery"])(sql, {
            cod_producto
        });
        if (!result || result.length === 0) {
            console.warn(`⚠️ Producto ${cod_producto} no encontrado, usando costo por defecto €0`);
            return 0;
        }
        // Por ahora, retornar costo por defecto
        // TODO: Implementar tabla de configuración real
        return 0;
    } catch (error) {
        console.error(`❌ Error obteniendo costo para ${cod_producto}:`, error);
        return 0; // Fallback a valor por defecto
    }
}
async function getAllProductCosts() {
    try {
        console.log('💰 Obteniendo todos los costos de productos');
        // Consulta para obtener todos los productos activos
        const sql = `
      SELECT DISTINCT
        cp.cod_producto,
        0 as costo_default -- Por defecto
      FROM cfg_producto cp
      WHERE cp.activo = 1
        AND cp.cod_producto IS NOT NULL
        AND cp.cod_producto != ''
        AND cp.cod_producto != '--'
        AND cp.cod_producto != '{0}'
    `;
        const products = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$lib$2f$database$2f$connection$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["executeQuery"])(sql);
        const costMap = {};
        if (products && products.length > 0) {
            products.forEach((product)=>{
                costMap[product.cod_producto] = product.costo_default;
            });
        }
        console.log(`💰 Costos obtenidos para ${Object.keys(costMap).length} productos`);
        return costMap;
    } catch (error) {
        console.error('❌ Error obteniendo todos los costos:', error);
        return {}; // Retornar mapa vacío como fallback
    }
}
async function GET(request) {
    try {
        console.log('⚙️ Obteniendo configuración de costos');
        // Obtener productos con sus máquinas asociadas
        const sql = `
      SELECT DISTINCT
        cp.cod_producto,
        cp.desc_producto,
        cm.Cod_maquina,
        cm.desc_maquina,
        0 as costo_unitario_default -- Sin productos = costo cero
      FROM cfg_producto cp
      LEFT JOIN cfg_maquina cm ON cp.cod_producto = cm.rt_Cod_producto
      WHERE cp.activo = 1
        AND cp.cod_producto IS NOT NULL
        AND cp.cod_producto != ''
        AND cp.cod_producto != '--'
        AND cp.cod_producto != '{0}'
      ORDER BY cp.cod_producto, cm.Cod_maquina
    `;
        const products = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$lib$2f$database$2f$connection$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["executeQuery"])(sql);
        // Crear estructura de respuesta
        const costConfig = {};
        products.forEach((product)=>{
            const productKey = product.cod_producto;
            if (!costConfig[productKey]) {
                costConfig[productKey] = {
                    cod_producto: product.cod_producto,
                    desc_producto: product.desc_producto,
                    costo_unitario: product.costo_unitario_default,
                    maquinas: [],
                    nota: 'Costo configurado manualmente (no viene de MAPEX)'
                };
            }
            if (product.Cod_maquina) {
                costConfig[productKey].maquinas.push({
                    cod_maquina: product.Cod_maquina,
                    desc_maquina: product.desc_maquina
                });
            }
        });
        console.log('⚙️ Configuración de costos obtenida:', Object.keys(costConfig).length, 'productos');
        return __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: true,
            data: costConfig,
            timestamp: new Date().toISOString(),
            nota: 'Costos por defecto: €0. Configure valores reales usando POST'
        });
    } catch (error) {
        console.error('❌ Error obteniendo configuración de costos:', error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: false,
            error: 'Error al obtener configuración de costos',
            details: error instanceof Error ? error.message : 'Error desconocido',
            timestamp: new Date().toISOString()
        }, {
            status: 500
        });
    }
}
async function POST(request) {
    try {
        console.log('💾 Configurando costo personalizado');
        const body = await request.json();
        const { cod_producto, costo_unitario, maquina_id } = body;
        if (!cod_producto || costo_unitario === undefined) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                success: false,
                error: 'Faltan parámetros requeridos: cod_producto y costo_unitario',
                timestamp: new Date().toISOString()
            }, {
                status: 400
            });
        }
        // Validar que el producto existe en MAPEX
        const checkProductSql = `
      SELECT cod_producto, desc_producto
      FROM cfg_producto
      WHERE cod_producto = @cod_producto
        AND activo = 1
    `;
        const productExists = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$lib$2f$database$2f$connection$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["executeQuery"])(checkProductSql, {
            cod_producto
        });
        if (!productExists || productExists.length === 0) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                success: false,
                error: `Producto ${cod_producto} no encontrado en MAPEX`,
                timestamp: new Date().toISOString()
            }, {
                status: 404
            });
        }
        // Aquí se podría guardar en una tabla de configuración
        // Por ahora, simularemos el guardado
        console.log('💾 Costo configurado:', {
            cod_producto,
            costo_unitario,
            maquina_id,
            producto: productExists[0].desc_producto
        });
        return __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: true,
            message: `Costo de €${costo_unitario} configurado para producto ${cod_producto}`,
            data: {
                cod_producto,
                costo_unitario: parseFloat(costo_unitario),
                maquina_id,
                producto_descripcion: productExists[0].desc_producto
            },
            timestamp: new Date().toISOString()
        });
    } catch (error) {
        console.error('❌ Error configurando costo:', error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: false,
            error: 'Error al configurar costo',
            details: error instanceof Error ? error.message : 'Error desconocido',
            timestamp: new Date().toISOString()
        }, {
            status: 500
        });
    }
}
}),
"[project]/Downloads/mrpii 2/src/app/api/analytics/daily/route.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "GET",
    ()=>GET
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/Downloads/mrpii 2/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$lib$2f$database$2f$connection$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/Downloads/mrpii 2/lib/database/connection.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$src$2f$app$2f$api$2f$scada$2f$costs$2d$config$2f$route$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/Downloads/mrpii 2/src/app/api/scada/costs-config/route.ts [app-route] (ecmascript)");
;
;
;
async function GET(request) {
    try {
        console.log('📅 Obteniendo resumen del día actual');
        // Obtener fecha actual
        const today = new Date();
        const startOfDay = new Date(today.getFullYear(), today.getMonth(), today.getDate());
        const endOfDay = new Date(today.getFullYear(), today.getMonth(), today.getDate() + 1);
        // Obtener costos de productos
        const productCosts = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$src$2f$app$2f$api$2f$scada$2f$costs$2d$config$2f$route$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getAllProductCosts"])();
        const costoPromedioNok = Object.keys(productCosts).length > 0 ? Object.values(productCosts).reduce((sum, cost)=>sum + cost, 0) / Object.keys(productCosts).length : 0; // Sin productos = costo cero
        console.log('💰 Costo promedio para cálculos diarios:', {
            totalProductos: Object.keys(productCosts).length,
            costoPromedio: costoPromedioNok,
            nota: Object.keys(productCosts).length > 0 ? 'Basado en costos reales de MAPEX' : 'Sin productos activos - costo cero'
        });
        // Consulta para obtener producción del día actual desde MAPEX
        const productionSql = `
      SELECT
        cm.Cod_maquina,
        cm.desc_maquina,
        COALESCE(SUM(hp.unidades_ok), 0) as ok,
        COALESCE(SUM(hp.unidades_nok), 0) as nok,
        COALESCE(SUM(hp.unidades_rw), 0) as rw
      FROM cfg_maquina cm
      LEFT JOIN his_prod hp ON cm.id_maquina = hp.id_maquina
        AND hp.fecha >= @startOfDay
        AND hp.fecha < @endOfDay
      WHERE cm.activo = 1
        AND cm.Cod_maquina != '--'
      GROUP BY cm.Cod_maquina, cm.desc_maquina
      ORDER BY cm.Cod_maquina
    `;
        console.log('🔍 Consultando producción del día actual desde MAPEX');
        const machinesData = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$lib$2f$database$2f$connection$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["executeQuery"])(productionSql, {
            startOfDay: startOfDay,
            endOfDay: endOfDay
        });
        // Calcular totales
        const totalOk = machinesData.reduce((sum, machine)=>sum + (machine.ok || 0), 0);
        const totalNok = machinesData.reduce((sum, machine)=>sum + (machine.nok || 0), 0);
        const totalRw = machinesData.reduce((sum, machine)=>sum + (machine.rw || 0), 0);
        const totalProduction = totalOk + totalNok + totalRw;
        const data = {
            ok: totalOk,
            nok: totalNok,
            rw: totalRw,
            total: totalProduction,
            eficiencia: totalProduction > 0 ? totalOk / totalProduction * 100 : 0,
            perdidas_eur: totalNok * costoPromedioNok,
            fecha: startOfDay.toISOString().split('T')[0],
            maquinas: machinesData.length,
            nota: costoPromedioNok > 0 ? 'Costo basado en configuración de productos MAPEX' : 'Sin productos activos - pérdidas en cero'
        };
        console.log('📅 Resumen del día actual:', {
            ...data,
            calculo_perdidas: costoPromedioNok > 0 ? `${totalNok} NOK × €${costoPromedioNok.toFixed(2)} = €${(totalNok * costoPromedioNok).toFixed(2)}` : `${totalNok} NOK × €0.00 = €0.00 (sin productos activos)`,
            costo_promedio_usado: costoPromedioNok
        });
        return __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: true,
            data,
            timestamp: new Date().toISOString(),
            periodo: 'dia_actual'
        });
    } catch (error) {
        console.error('❌ Error obteniendo datos del día actual:', error);
        // En caso de error, retornar datos vacíos
        const emptyData = {
            ok: 0,
            nok: 0,
            rw: 0,
            total: 0,
            eficiencia: 0,
            perdidas_eur: 0,
            fecha: new Date().toISOString().split('T')[0],
            maquinas: 0,
            nota: 'Error al obtener datos - valores en cero'
        };
        return __TURBOPACK__imported__module__$5b$project$5d2f$Downloads$2f$mrpii__2$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: true,
            data: emptyData,
            timestamp: new Date().toISOString(),
            periodo: 'dia_actual',
            error: error instanceof Error ? error.message : 'Error desconocido'
        });
    }
}
}),
];

//# sourceMappingURL=%5Broot-of-the-server%5D__053bf823._.js.map