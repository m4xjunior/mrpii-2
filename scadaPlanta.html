<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
	<title>Planta de Grupo KH</title> 
	<link rel="shortcut icon" type="image/x-icon" href="../images/logo_kh.ico">
	<meta name="viewport" content="width=device-width, initial-scale=1 ,  user-scalable=no"> 
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable"  content="yes">
        
        
        
	<link rel="stylesheet" href="../css/jquery.mobile-1.4.5.min.css" />
	<script src="../libs/jquery-2.1.4.min.js"></script>
	<script src="../libs/jquery.mobile-1.4.5.min.js"></script>
	<script src="../libs/jquery.blockUI.js"></script>
	<script src="../libs/DataTables/datatables.js"></script>
        <style type="text/css">
html,body { 
  overflow:hidden; 
}
</style>
  <script>             
var ratio =1  ;
var rotar = 0;
function escalar(){    

 function getViewportWidth() {

                    return window.innerWidth;

            }

            function getViewportHeight() {

                    return window.innerHeight;

            }
          
                var actual_width ;
                var actual_height ;


                 actual_width = getViewportWidth()  ;
                 actual_height = getViewportHeight() ;

//alert ( "X: " + actual_width + " Y : " + actual_height );

		//if (actual_width > 1280 ) actual_width = 1280;



                var min_width = 1366;
                var min_height = 768;
                
                $('#ancho').text = actual_width;
                $('.alto').val(actual_height);
                //alert(actual_width);

var ratio =  actual_width / min_width ;

                     $('.screen').css('zoom', ' ' + ratio * 100 + '%');

 //window.scrollTo(0, 15);

}

$( window ).resize(function() {
      //alert("RES2");
escalar();
});

//function setRefresco(){
  //  window.setInterval(refresco(),5000);
    
//}

var arduino = 0;
var contaarduino = 0;
var ajaxposicion = 0;
var contaposicion = 0;
var load = 0;
var contaload = 0;
var tid;
var contador;
var referencia;
var semaforo = 0;
contador = 0;
var hora = 0;
var tiempo = 0;
var operarios;
var posiciones = 10;
var ciclo = 0;
var contaciclos = 0;
var contaciclos_ant = 0;
var cantidad = 0;
var entrada= new Date();
var tiempo_insp_uni = 15;
var barra = 0;
var of = "";
var hora_entrada = "";
var fecha_entrada = "";

var html = '';
var html_ant = 'VACIA';
var barra_siguiente = "";
var primera_carga = 1;
var alerta = 0;

var ult_ciclo = 0;
var ult_conta_ciclo = 0;
var cod_incidencia = 0;
var tmp_ciclos = 0;

var est_of = '';
var est_ciclos = 0;
var est_fecha = "00000000";
var est_hora = 0;
var est_incidencia = 0;

var vest_hora ="00:00:00";
var aviso_inc = 0;

var incidencia = 0;
var inc_inicio = "00:00:00";
var base = 15*60;

 //$( "#posicion" ).empty();
 //$( "#posicion" ).append( posicion );

var bench  = 1000 + new Date().getTime(),
    timer  = setInterval(
               function(){ 
                 checkTime(bench); 
               }
               , 100000
             );



	
$.ajax({
                url: "php/scadaPlanta.php",
                cache: false,
                async: true,
                success: function(html){
                $("#datos").empty();    
                $( "#datos" ).append( html);
                //alert("*"+html+"*");
                
                }
                });
				
				
 

function checkTime(this_time){
    function checkTime(i) {
        return (i < 10) ? "0" + i : i;
    }
    
    contaload++;
    if ((contaload > 10)) {
    	load = 0;
    	contaload = 0;
    }	

    var check = new Date - this_time;
	
	
	$("#hora").empty();
        var today = new Date();
        h = checkTime(today.getHours()),
        m = checkTime(today.getMinutes()),
        s = checkTime(today.getSeconds());
           
            		$( "#hora" ).append("<H1>"+h + ":" + m + ":" + s+"</H1>");
            	
	
	
    	
    	
    	
    	
    	
    	
    	
    	
    	
    	
        //contador++;
        
            	
            	
            	//ESTADO
            	
            	//VER HORA ULTIMO CICLO y ULTIMO CICLO
            	
            	$.ajax({
              
                	
               	url: "php/scadaPlanta.php",
                cache: false,
                async: true,
                //timeout: 3000,
                dataType: "text",
                success: function(scada){ 
                //	alert(estado);
                 $("#datos").html(scada);
                
                
                
                
                }
                
                });
                
                
                
                            	
            	//var vest_hora = est_hora.split(":");
            	var a = new Date(); // Current date now.
            	//alert ( est_fecha.substring(0,4) + "/" + est_fecha.substring(4,6) + "/" + est_fecha.substring(6,8) );
				var b = new Date(est_fecha.substring(0,4), est_fecha.substring(4,6)-1, est_fecha.substring(6,8),  vest_hora[0], vest_hora[1], vest_hora[2] , 0); // Start of 2010.
				
				var seconds = parseInt((a-b)/1000);
            	//alert (a + " " + b + " " + seconds);
            	
          
                
           if (hora_entrada!="") {
               //alert(Math.floor((new Date().getTime() - new Date("2015-09-10 "+hora_entrada+":00").getTime())/1000));
           }
            new Date();
            $( "#tiempo_max" ).empty();
            tiempo = (Math.floor(ciclo*posiciones) - 60 -  Math.floor(((new Date().getTime() - new Date(fecha_entrada).getTime())/1000)));
            //t_min = tiempo.getMinutes();
            //t_sec = tiempo.getSeconds();
            var t_min = "0" + Math.floor(tiempo / 60);
            var t_sec = "0" + (tiempo - t_min * 60);
            //return minutes.substr(-2) + ":" + seconds.substr(-2);
            $( "#tiempo_max" ).append( "<H1>" + t_min.substr(-2) + ":"+ t_sec.substr(-2)  + "</H1>");//posiciones * ciclo ) -
            //$( "#tiempo_max" ).append( "<H1>" +  new Date( "2015/09/10 " + hora_entrada ) + "</H1>");
            $("#tiempo_insp").empty();
            if (cantidad > 0){
            	coperarios = operarios;
            if (operarios==0) coperarios = 1;	
            i_tiempo = (tiempo_insp_uni * cantidad / coperarios   -  Math.floor(((new Date().getTime() - entrada.getTime())/1000)));
            var i_min =  "0" + Math.floor(i_tiempo / 60);
            var i_sec =  "0" + (i_tiempo - i_min * 60);
            if (i_tiempo>0) {
                $("#tiempo_insp").append( "<H1>"  + i_min.substr(-2) + ":"+ i_sec.substr(-2)  + "</H1>");//t_min.substr(-2) + ":"+ t_sec.substr(-2)
            } else {
                $("#tiempo_insp").append( "<H1>SUP.</H1>");
            }
        }
 

    }

   
   
         
         
        
    
   
   
   
    
    var pantalla_datos;
    
    
    function info(){
        // alert("PartesOld/partes_inspeccionar.html?orden="+ $( "#barra" ).html() + "&operario= " + posicion);
     /*$.ajax({
                url:   "PartesOld/partes_inspeccionar_offline.html?orden="+ barra + "&operario= " + posicion,
                cache: false,
                async: true,
                success: function(html){
                 $("#datos").html(html);
                 
                
}


        });*/
             $.ajax({
                url:    "banner.html?referencia="+ $( "#referencia" ).html(),
                cache: false,
                async: true,
                success: function(html){
                 $("#datos").html(html);
                 
                
}


        });
        escalar();
    
        
    }
    
    
        </script>
        
        
        
    </head>
    <body >
        <div data-role="page" id="main" class="screen" data-theme="a ">

	<div data-role="header" style="bottom: 0px; data-position=; height:80px;  background-image: url(../images/logo_transparent1040.png) ;  background-size: 170px; background-position:99% 5px; background-repeat: no-repeat; background-color: lightgray" data-position="fixed">
            <div class="ui-grid-d" id="topbar">
                 <div class="ui-block-a"   style="width: 29%;font-size: 180% ;height:80px; vertical-align: middle;"  onClick="layout();">  
					<div class="ui-block-a" id="posicion"  style="width: 100%;font-size: 100% ;height:40px; vertical-align: top;"  onClick="layout();">  </div>
					<div class="ui-block-b" id="posicionD"  style="width: 100%;font-size: 100% ;height:40px; vertical-align: down;"  onClick="layout();">  </div>
				 </div>
                 <div class="ui-block-b" id="referencia"  style="width: 18%;font-size: 180% ;height:80px; vertical-align: middle;"  onClick="detalleOF();" >  </div>    
                 <div class="ui-block-c" id="descripcion"  style="width: 35%;font-size: 180% ;height:80px; vertical-align: middle;"  onClick="detalleOF();" ></div>
                 <div class="ui-block-d" id="cantidad"  style="width: 8%;font-size: 150% ;height:80px; vertical-align: middle;"  onClick="detalleOF();" >  </div>
                 <div class="ui-block-e" id="barra"  style="width: 0%;font-size: 150% ;height:80px; vertical-align: middle;"  onClick="detalleOF();" >  </div>
            </div> 
	</div><!-- /header -->
        <div  >
            <div class="ui-grid-a" id="leftbar"  style="bottom: 50px;height:650px;" >
	<div class="ui-block-a" id="menu" style="width: 10px ;  position: blocked;"> 
            <div>
           
        </div>
                
                
	<div class="ui-block-b" id="datos"  data-role="content" style="width: 1595px;height:1000px;  " >
		
		
	
		
	</div> <!--1780px;">height: 98%x; position: blocked;</div>-->
</div><!-- /grid-a -->
            
            
      
           
        </div>
        <div data-role="footer" data-position="fixed" style="bottom: 0px; height:50px; ">
             <div class="ui-grid-c" id ="downbar">
                 <div class="ui-block-a" id="hora" style="width: 15% "> 
		<h1>  </h1>
                 </div>
                 <div class="ui-block-b" id="arduino" style="width: 0%; vertical-align: middle;"> 
	
                 </div>
                 <div class="ui-block-b" id="toperarios" style="width: 5%; vertical-align: middle;"> 
		<h1>  </h1>
                 </div>
                 <div class="ui-block-b" id="it" style="width: 5%; vertical-align: middle;"  onClick="it();"> 
		<img src='../images/info_button_32.png'>
                 </div>
                  <div class="ui-block-c" id="info" style="width: 35% ;font-size: 150% ;height:50px; vertical-align: middle;">
                      <h1><center>.</center></h1>
                 </div>
                 <div class="ui-block-b" id="pendiente" style="width: 40% ;font-size:75% ;vertical-align: top; horizontal-align: middle;"> 
		
                 
                  <div class="ui-grid-b" id ="downbar1">
                  	
                 <div class="ui-block-a"  style="width: 33% ; vertical-align: middle; horizontal-align: middle;"> 
                 
                  <div class="ui-grid-a" id ="downbara">
                  	<div class="ui-block-a" id="ref1" style="width: 100% ; vertical-align: middle; horizontal-align: middle;"> 
		
                 </div>
                 <div class="ui-block-a" id="canreal" style="width: 50% ; vertical-align: middle; horizontal-align: middle;"> 
		
                 </div>
                 <div class="ui-block-b" id="canteo" style="width: 50%; vertical-align: middle;"> 
	
                 </div>
                 </div>
                 </div>
                 <div class="ui-block-b"  style="width: 33% ;  horizontal-align: middle;"> 
                 
                  <div class="ui-grid-a" id ="downbara">
                  	<div class="ui-block-a" id="ref2" style="width: 100% ;  horizontal-align: middle;"> 
		
                 </div>
                 <div class="ui-block-a" id="canreal2" style="width: 50% ;horizontal-align: middle;"> 
	
                 </div>
                 <div class="ui-block-b" id="canteo2" style="width: 50%; "> 
		
                 </div>
                 </div>
                 </div>
                 
                 <div class="ui-block-c"  style="width: 33% ;  horizontal-align: middle;"> 
                 
	
                 
                  <div class="ui-grid-a" id ="downbara">
                  	<div class="ui-block-a" id="ref3" style="width: 100% ;horizontal-align: middle;"> 
                  	</div>
                 <div class="ui-block-a" id="canreal3" style="width: 50% ; horizontal-align: middle;"> 
		
                 </div>
                 <div class="ui-block-b" id="canteo3" style="width: 50%;"> 
	
                 </div>
                 </div>
                 </div>
                 
                 </div>
                 </div>
	</div><!-- /footer -->
</div><!-- /page -->

    </body>
    <script> 
        
        escalar();
       // tid=setInterval(refresco(),10000);
      // $(document).ready(tid=setInterval(refresco(),10000));
    </script>
</html>
