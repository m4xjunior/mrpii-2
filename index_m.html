<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
	<title>Planta de Inyeccion - Montajes/Muros/PNC</title> 
	<link rel="shortcut icon" type="image/x-icon" href="images/mrpii.ico">
	<meta name="viewport" content="width=device-width, initial-scale=1 ,  user-scalable=no"> 
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable"  content="yes">
        
        
        
	<link rel="stylesheet" href="css/jquery.mobile-1.4.5.min.css" />
	<script src="js/jquery-2.1.4.min.js"></script>
	<script src="js/jquery.mobile-1.4.5.min.js"></script>
        <style type="text/css">
html,body { 
  overflow:hidden; 
}
</style>
  <script>             
var ratio =1  ;
var rotar = 0;

/*function TriggeredKey(e)
    {
        var keycode;
        if (window.event) keycode = window.event.keyCode;
        if (window.event.keyCode = 13 ) return false;
    }
    */
function escalar(){    

 function getViewportWidth() {

                    return window.innerWidth;

            }

            function getViewportHeight() {

                    return window.innerHeight;

            }
          
                var actual_width ;
                var actual_height ;


                 actual_width = getViewportWidth()  ;
                 actual_height = getViewportHeight() ;




		//if (actual_width > 1280 ) actual_width = 1280;



                var min_width = 1600;
                var min_height = 900;
                
                $('#ancho').text = actual_width;
                $('.alto').val(actual_height);
                //alert(actual_width);

var ratio =  actual_width / min_width ;

                     $('.screen').css('zoom', ' ' + ratio * 100 + '%');

 //window.scrollTo(0, 15);

}

$( window ).resize(function() {
      //alert("RES2");
escalar();
});

//function setRefresco(){
  //  window.setInterval(refresco(),5000);
    
//}

var tid;
var contador;
var referencia;
var semaforo = 0;
contador = 0;
var hora = 0;
var tiempo = 0;
var operarios = 1;
var posicion;
var puesto;
posicion = <?php  echo substr($_GET["posicion"],2,3);?>;
puesto =<?php  echo "'".($_GET["posicion"])."'";?>;
var ubicacion;
ubicacion = <?php echo "'".substr($_GET["posicion"],0,2)."'";?>;

var cantidad = 0;
var entrada= new Date();
var new_login = 1;

var html = '';
var html_ant = 'VACIA';

var barra;
var barra_log;
var articulo_log;
var of_log;
var of;
var articulo;
var operario_log;



var html_ant = "INICIO";

    //onload="setRefresco();"        
    
    
    
var bench  = 1000 + new Date().getTime(),
    timer  = setInterval(
               function(){ 
                 checkTime(bench); 
               }
               , 1000
             );
var html_ant = "INICIO";
function checkTime(this_time){
    function checkTime(i) {
        return (i < 10) ? "0" + i : i;
    }
    //if contador == 00) {
    contador++;
    var check = new Date - this_time;
    if(check>=10){
        /*
        if (new_login == 1) {
            //alert(newlogin);
            new_login = 0;*/
             if ((semaforo==0) && (contador >=10)) {
                 contador = 0;
                    $.ajax({
                 
                url: "php/operarios_m_full.php?puesto="+posicion+"&ubicacion="+ubicacion,
                cache: true,
                async: true,
                success: function(html){
                $("#datos").empty();    
                $( "#datos" ).append( html);
                }  
                });
                
                
           }
        
        //contador++;
        $("#hora").empty();
        var today = new Date();
        h = checkTime(today.getHours()),
        m = checkTime(today.getMinutes()),
        s = checkTime(today.getSeconds());
                $( "#hora" ).append("<H1>"+h + ":" + m + ":" + s+"</H1>");
        /*if ((s.toString().substr(1,1) == '0') || (s.toString().substr(1,1) == '5'))//~~(s/10)*10 == s)
        {
            $.ajax({
                url: "php/operarios.php?puesto="+posicion,
                cache: false,
                async: false,
                success: function(html){
                $("#datos").empty();    
                $( "#datos" ).append( html);
                }  
                });
            
            
    
           
        }*/
 
 /*$.ajax({
                url: "php/operarios_online.php?puesto="+<?php echo $_GET["posicion"];?>,
                cache: false,
                async: true,
                success: function(html){
                    if (html_ant!=html) contador = 0;
                    $("#datos").empty();
                    operarios = html * 1;
                $( "#datos" ).append("<H1>" + html + "</H1>");
                
  
}
 });*/
        //clearInterval(timer);
    }
}
    //onload="setRefresco();"        
    
    
    var pantalla_datos;
    
    function login(){
        semaforo = 1;
     pantalla_datos =    $("#datos").html();
     $("#datos").empty();
     $("#datos").load("login_m.html"+ "?puesto=" + posicion+"&ubicacion="+ubicacion);//.appendTo( ".ui-page" ).trigger( "create" );
   //  escalar();
   
        /*$.ajax({
                url: "php/operarios_m_full.php?puesto="+posicion+"&ubicacion="+ubicacion,
                cache: false,
                async: false,
                success: function(html){
                $("#datos").empty();    
                $( "#datos" ).append( html);
                }  
                });*/
        new_login = 1; 
        operarios = 1;
    }
    
    function user_login( barra, of , ubicacion , referencia){

   semaforo = 1 ;
        if (document.forms["frmDatos"].elements["operario"].value == "") {
            
            alert ("Operario no valido.");
        }else {
$.ajax({
                url:   "php/login_m.php?operario="+document.forms["frmDatos"].elements["operario"].value + "&puesto=" + posicion+"&ubicacion="+ubicacion+"&barra="+ barra + "&of=" + of + "&articulo=" + referencia,
                cache: true,
                async: true,
                success: function(html){
                 $("#datos").html(pantalla_datos);
}


        
            
        });
        
         if (semaforo==0) $.ajax({
                url: "php/operarios_m_full.php?puesto="+posicion+"&ubicacion="+ubicacion,
                cache: true,
                async: true,
                success: function(html){
                $("#datos").empty();    
                $( "#datos" ).append( html);
                }  
                });
        
 /*operarios = operarios + 1;
    
    $("#datos").empty();
        
                $( "#datos" ).append("<H1>"+operarios+"</H1>");*/
        }
           semaforo = 0;
}
    
    function logout(){
           semaforo = 1;
    // pantalla_datos =    $("#datos").html();
    // $("#datos").trigger('create');
    //$("#datos").empty();
    //$("#datos").load("logout.html" + "?puesto=" + <?php echo $_GET["posicion"];?>).enhanceWithin();//.appendTo( ".ui-page" ).trigger( "create" );  
     //$( "#datos" ).load(  "logout.html", { role: "content" } );

    // escalar();
    
    $.ajax({
                url:   "php/logout_m.php?operario="+operario_log + "&puesto="  +"&ubicacion="+"&barra=" + "&of="  + "&articulo=",
                cache: true,
                async: true,
                success: function(html){
                // $("#datos").html(pantalla_datos);
}


        
            
        });
     if (semaforo==0) $.ajax({
                url: "php/operarios_m_full.php?puesto="+posicion+"&ubicacion="+ubicacion,
                cache: true,
                async: true,
                success: function(html){
                $("#datos").empty();    
                $( "#datos" ).append( html);
                }  
                });
                vaciar();
           operarios = 1;
    }
    
    
    function deshabilitar(){
        
     
     // Disable #x
    //$( "#x" ).prop( "disabled", true );
    $( "#partes" ).addClass('mobile-button-disabled');
        //$( "#partes" ).prop( "disabled", false );
        $( "#partes" ).button( "option", "disabled", true );
         $( "#pi" ).addClass('mobile-button-disabled');
        //$( "#partes" ).prop( "disabled", false );
        $( "#pi" ).button( "option", "disabled", true );
         $( "#pe" ).addClass('mobile-button-disabled');
        //$( "#partes" ).prop( "disabled", false );
        $( "#pe" ).button( "option", "disabled", true );
         $( "#qa" ).addClass('mobile-button-disabled');
        //$( "#partes" ).prop( "disabled", false );
        $( "#qa" ).button( "option", "disabled", true );
         $( "#logout" ).addClass('mobile-button-disabled');
        //$( "#partes" ).prop( "disabled", false );
        $( "#logout" ).button( "option", "disabled", true );
         $( "#etiqueta" ).addClass('mobile-button-disabled');
        //$( "#partes" ).prop( "disabled", false );
        $( "#etiqueta" ).button( "option", "disabled", true );
        $( "#partes" ).prop( "disabled", true );
        $( "#pi" ).prop( "disabled", true );
        $( "#pe" ).prop( "disabled", true );
        $( "#qa" ).prop( "disabled", true );
        $( "#logout" ).prop( "disabled", true );
        $( "#etiqueta" ).prop( "disabled", true );
        
                
        barra ="";
        barra_log ="";
        articulo_log ="";
        of_log ="";
        of ="";
        articulo ="";        
      //alert("DES");
        
    }
    
    function habilitar(){
        //alert("HABILITAR");
        // Enable #x
        //$( "#x" ).prop( "disabled", false );
        //$( "#partes" ).removeClass('ui-state-disabled');
        $( "#partes" ).removeClass('mobile-button-disabled');
        //$( "#partes" ).prop( "disabled", false );
        $( "#partes" ).button( "option", "disabled", false );
         $( "#pi" ).removeClass('mobile-button-disabled');
        //$( "#partes" ).prop( "disabled", false );
        $( "#pi" ).button( "option", "disabled", false );
         $( "#pe" ).removeClass('mobile-button-disabled');
        //$( "#partes" ).prop( "disabled", false );
        $( "#pe" ).button( "option", "disabled", false );
         $( "#qa" ).removeClass('mobile-button-disabled');
        //$( "#partes" ).prop( "disabled", false );
        $( "#qa" ).button( "option", "disabled", false );
         $( "#logout" ).removeClass('mobile-button-disabled');
        //$( "#partes" ).prop( "disabled", false );
        $( "#logout" ).button( "option", "disabled", false );
         $( "#etiqueta" ).removeClass('mobile-button-disabled');
        //$( "#partes" ).prop( "disabled", false );
        $( "#etiqueta" ).button( "option", "disabled", false );
        $( "#pi" ).prop( "disabled", false );
        $( "#pe" ).prop( "disabled", false );
        $( "#qa" ).prop( "disabled", false );
        $( "#logout" ).prop( "disabled", false );
        $( "#etiqueta" ).prop( "disabled", false );
        
    }
    
        function user_online(lusuario , lbarra , lof , larticulo){
   semaforo = 1;
barra_log = lbarra;
barra = lbarra;
operario = lusuario;
operario_log = lusuario;
of = lof;
of_log = lof;
articulo = larticulo;
articulo_log = larticulo;
//alert("CONECTAR" + operario + " " +barra+ " " + of + " " + articulo);
habilitar();
qapi();
/*$.ajax({
                url:   "php/logout.php?operario="+ usuario + "&puesto=" + <?php echo $_GET["posicion"];?>,
                cache: false,
                async: false,
                success: function(html){
                 $("#datos").html(pantalla_datos);
}


        });*/
       /* operarios = operarios - 1;
    $("#datos").empty();
        
                $( "#datos" ).append("<H1>"+operarios+"</H1>");
        */
     
       
    }
    
    function partes(){
           semaforo = 1;
        //alert("PartesOld/partes_inspeccionar.html?orden="+ $( "#barra" ).html() + "&operario= " + posicion);
		   if (ubicacion=="PN") {
		   $.ajax({
                url:   "php/partespnc.php?orden="+barra+ "&operario= " + operario + "&of=" + of_log + "&puesto=" + posicion  + "&ubicacion=" + ubicacion + "&referencia=" + articulo_log ,
                cache: true,
                async: true,
                success: function(html){
                 //$("#datos").html(html);
                 
                
}


        }); 
		   
		   } else {
     $.ajax({
                url:   "PartesOld/partes_inspeccionar_m_offline.html?orden="+ barra_log + "&operario= " + operario + "&of=" + of_log + "&puesto=" + posicion  + "&ubicacion=" + ubicacion + "&referencia=" + articulo_log  ,
                cache: true,
                async: true,
                success: function(html){
                // $("#datos").html(html);
                 
                
}


        });
		}
        
    }
            function partes_diferido(){
                   semaforo = 1;
        // alert("PartesOld/partes_inspeccionar.html?orden="+ $( "#barra" ).html() + "&operario= " + posicion);
     $.ajax({
                url:   "inspeccion_diferido_v2.html?orden=&operario=" + posicion,
                cache: true,
                async: true,
                success: function(html){
                 $("#datos").html(html);
                 
                
}


        });
        
    }
    
    function inspecciona_barra_diferido(direccion_barra){
           semaforo = 1;
          $.ajax({
                url:   direccion_barra,
                cache: true,
                async: true,
                success: function(html){
                 $("#datos").html(html);
                 
                
}


        });   
        
        
    }
    
    function info(){
           semaforo = 1;
        // alert("PartesOld/partes_inspeccionar.html?orden="+ $( "#barra" ).html() + "&operario= " + posicion);
     /*$.ajax({
                url:   "PartesOld/partes_inspeccionar_offline.html?orden="+ barra + "&operario= " + posicion,
                cache: false,
                async: true,
                success: function(html){
                 $("#datos").html(html);
                 
                
}


        });*/
             $.ajax({
                url:    "banner.html?referencia="+ articulo_log,
                cache: true,
                async: true,
                success: function(html){
                 $("#datos").html(html);
                 
                
}


        });
        escalar();
    
        
    }
    
    
        function reload(){
           semaforo = 0;
     location.reload();
        
    }
    
    function vaciar(){
        
     $("#datos").html("");
     deshabilitar();  
     semaforo = 0;
    if (semaforo==0) $.ajax({
                url: "php/operarios_m_full.php?puesto="+posicion+"&ubicacion="+ubicacion,
                cache: true,
                async: true,
                success: function(html){
                $("#datos").empty();    
                $( "#datos" ).append( html);
                }  
                });
        
       semaforo = 0;
     
    }
    
    function volver() {
        vaciar();
    }
    
    function Volver() {
        vaciar();
    }

     function etiquetas_caja(){
           semaforo = 1;
		   
		
    $.ajax({
                url:   "EtiquetasCaja.html?orden="+barra+"&etiquetas="+cantidad+"&posicion="+posicion,
                cache: true,
                async: true,
                success: function(html){
                 $("#datos").html(html);
                 
                
}


        }); 
		
          
    }
    
    function pi(){
        
                semaforo = 1;
        $.ajax({
                url:    "pi.html?referencia="+ articulo_log,
                cache: true,
                async: true,
                success: function(html){
                 $("#datos").html(html);
                 
                
}


        });
        escalar();
    }
    
      function qapi(){
        
                semaforo = 1;
        $.ajax({
                url:    "qapi.html?referencia="+ articulo_log,
                cache: true,
                async: true,
                success: function(html){
                 $("#datos").html(html);
                 
                
}


        });
        escalar();
    }
    
        function pe(){
               semaforo = 1;
        $.ajax({
                url:   "pe.html?referencia="+ articulo_log,
                cache: true,
                async: true,
                success: function(html){
                 $("#datos").html(html);
                 
                
}


        });
        escalar();
     
    }
    
     function qa(){
            semaforo = 1;
        $.ajax({
                url:   "qa.html?referencia="+ articulo_log,
                cache: true,
                async: true,
                success: function(html){
                 $("#datos").html(html);
                 
                
}


        });
        escalar();
     
    }
//$( "#frmDatos" ).trigger("create");


	function calc(){
		
		
		var myWindow = window.open("calc.html", "Calculadora", "top=250,left=300,width=290,height=340,resizable=no,scrollbars=no,status=no,titlebar=no,toolbar=no,directories=no,");
	//	myWindow.document.write("calc.html");menubar=yes|no|1|0	Whether or not to display the menu bar
//resizable=yes|no|1|0	Whether or not the window is resizable. IE only
//scrollbars=yes|no|1|0	Whether or not to display scroll bars. IE, Firefox & Opera only
//status=yes|no|1|0	Whether or not to add a status bar
//titlebar=yes|no|1|0	Whether or not to display the title bar. Ignored unless the calling application is an HTML Application or a trusted dialog box
//toolbar=yes|no|1|0
		
	}


  function etiquetas( ereferencia , etipo ){
    	
    /*	
         eof =  $( "#barra" ).html();
         epieza =   $( "#referencia" ).html();
         ecantidad =   $( "#cantidad" ).html();
         ecanreal =   $( "#canreal" ).html();
         ecantro =   $( "#canteo" ).html();
    	alert(eof);
    	alert (ecantidad);
    	
    	alert (epieza);
    	alert (ecanreal);
    	alert (ecantro);*/
    	
    //	alert(ereferencia + articulo);
    	
     //   if (ereferencia=="undefined") ereferencia = articulo;
        
     //   if (etipo=="undefined") etipo ="";
    $.ajax({
                url:   "Etiquetas_m.php?orden="+of+"&etiquetas="+"1"+"&posicion=MBE"+posicion+"&referencia="+articulo+"&tipo="+etipo,
                cache: true,
                async: true,
                success: function(html){
                	 $("#datos").empty();
                 $("#datos").html(html);
                 
                
}


        }); 
        escalar();
    }

        </script>
        
        
        
    </head>
     <body onload="vaciar()">
        <div data-role="page" id="main" class="screen" data-theme="a">

	<div data-role="header" style="bottom: 0px; data-position=; height:50px;  background-image: url(images/GrupoMatrival_small.png) ;  background-size: 80px; background-position:99% 5px; background-repeat: no-repeat; background-color: lightgray">
            <div class="ui-grid-d" >
                 <div class="ui-block-a" id="posicion"  style="width: 20%;font-size: 250% ;height:50px; vertical-align: middle;">  </div>
                 <div class="ui-block-b" id="referencia"  style="width: 20%;font-size: 250% ;height:50px; vertical-align: middle;">  </div>    
                 <div class="ui-block-c" id="descripcion"  style="width: 40%;font-size: 250% ;height:50px; vertical-align: middle;"> PARTES DE TRABAJO </div>
                 <div class="ui-block-d" id="cantidad"  style="width: 10%;font-size: 250% ;height:50px; vertical-align: middle;">  </div>
                 <div class="ui-block-e" id="barra"  style="width: 10%;font-size: 250% ;height:50px; vertical-align: middle;">  </div>
            </div> 
	</div><!-- /header -->
        <div  >
            <div class="ui-grid-a" >
	<div class="ui-block-a" id="menu" style="width: 140px ;  position: blocked;"> 
            <div>
            <center><input type="button" style="size: 100%" value="LOGIN" onClick="login();"></center>
            <center><input type="button" style="size: 100% ; height: 200px ; font-size: 48px " value="PARTES" id="partes" onClick="partes();"></center>

            
            <center><input type="button" style="size: 100%" value="P.I."  id="pi" onClick="pi();"></center>
            <center><input type="button" style="size: 100%" value="P.E." id="pe" onClick="pe();"></center>
            <center><input type="button" style="size: 100%" value="Q.A." id="qa" onClick="qa();"></center>
           <!-- <center><input type="button" style="size: 100%" value="CALCULADORA" onClick="calc();"></center>-->
            <center><input type="button" style="size: 100%" value="LOGOUT" id="logout" onClick="logout();"></center>
            <center><input type="button" style="size: 100%" value="ETIQUETAS" id="etiqueta" onClick="etiquetas();"></center>
            <!-- <center><input type="button" style="size: 100%"  id="ETIQUETA"  value="ETIQUETA" onClick="etiquetas();"></center> -->
            
            <center><input type="button" style="size: 100%" value="RELOAD" onClick="reload();"></center>
            <center><input type="button" style="size: 100%" value="CALCULADORA" onClick="calc();"></center>
            <center><input type="button" style="size: 100%" value="PRINCIPAL" onClick="vaciar();"></center>
           <!--  <center><div onClick="partes_diferido();"><input type="button" style="size: 100% ; height: 200px ; font-size: 48px " value="PARTES<BR>DIFERIDO" onClick="partes_diferido();"></div></center> -->
            </div>
            <div id="operarios">
                
                </div>
        </div>
                
                
	<div class="ui-block-b" id="datos"  data-role="content" style="width: 1400px; height: 785px; backgroundcolor: white; position: float;"></div> <!--1780px;"></div>-->
</div><!-- /grid-a -->
            
            
      
           
        </div>
        <div data-role="footer" data-position="fixed" style="bottom: 0px; data-position=; height:50px;">
             <div class="ui-grid-d" >
                 <div class="ui-block-a" id="hora" style="width: 15% "> 
		<h1> HORA: </h1>
                 </div>
                 <div class="ui-block-b" id="operarios" style="width: 5%; vertical-align: middle;"> 
		<h1> 0 </h1>
                 </div>
                  <div class="ui-block-c" id="siguiente" style="width: 60% ;font-size: 150% ;height:50px; vertical-align: middle;">
                      <h1><center>.</center></h1>
                 </div>
                 <div class="ui-block-d" id="tiempo_insp" style="width: 10% ; vertical-align: middle; horizontal-align: middle;"> 
		<h1>  </h1>
                 </div>
                 <div class="ui-block-e" id="tiempo_max" style="width: 10%; vertical-align: middle;"> 
		<h1> </h1>
                 </div>
	</div><!-- /footer -->
</div><!-- /page -->
    </body>
    <script> 
        if (ubicacion=="ME") posicion= posicion+80;
        if (ubicacion=="BO") posicion= posicion+50;
        if (ubicacion=="BE") posicion= posicion+100;
		if (ubicacion=="PN") posicion= posicion+150;
        //alert (ubicacion + " " + posicion);
         $( "#posicion" ).empty();
         if (ubicacion=="ME") posicion2 =  posicion*1 - 80;
         if (ubicacion=="BO") posicion2 =  posicion*1 - 50 ;
         if (ubicacion=="BE") posicion2= posicion*1 -100;
		 if (ubicacion=="PN") posicion2= posicion*1 - 150;
        $( "#posicion" ).append( "POS: " +  <?php echo '"'.substr($_GET["posicion"],0,2).'"';?> + ("00" + posicion2.toString()).substr(-2) );
        //deshabilitar();
        escalar();
       // tid=setInterval(refresco(),10000);
      // $(document).ready(tid=setInterval(refresco(),10000));
    </script>
</html>
